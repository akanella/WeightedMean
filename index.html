<!DOCTYPE html>
<html>
<meta charset="utf-8">

<head>
    <title data-translate="Weighted Mean">Weighted Mean</title>
    <script src="js/jquery.min.js"></script>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <script src="js/bootstrap.min.js"></script>
    <script src="js/translation.js"></script>
    <script src="js/chart.min.js"></script>
</head>

<style>
table {
  font-family: arial, sans-serif;
  border-collapse: collapse;
  width: 100%;
}

td, th {
  border: 1px solid #dddddd;
  text-align: left;
  padding: 8px;
}
</style>

<body style="padding-bottom: 90px;">
    <div class="row col-12" style="margin-bottom:30px">
        <div class="col-10">
            <b data-translate="Weighted Mean Calculator">Weighted Mean Calculator</b>
            <span>v. 1.0</span>
        </div>
        <div class="col-2">
            <span style="cursor:pointer" class="languages" data-lang="eng"> en </span>
            <span> | </span>
            <span style="cursor:pointer" class="languages" data-lang="fr"> fr </span>
            <span> | </span>
            <span style="cursor:pointer" class="languages" data-lang="de"> de </span>
        </div>
    </div>
    <form id="Weighted-Mean">
        <div class="row col-8 offset-2">
			<div class="col row">
				<div class="col-12 ">
					<button type="button" class="btn btn-success btn-circle" style="border-radius:40%"
						id="addsample-btn">+</button>
					<button type="button" class="btn btn-danger btn-circle" style="border-radius:40%"
						id="removesample-btn">-</button>
				</div>
				<div class="form-group col">
					<label for="Values" data-translate="Values">Values</label>
					<input type="number" id="val" name="val[]" class="form-control required">
				</div>
			</div>
			<div class="col row">
				<div class="col-12 ">
					<h5>&nbsp;</h5>
				</div>
				<div class="form-group col">
					<label for="Uncertainties" data-translate="Uncertainties">Uncertainties</label>
					<input type="number" id="unc" name="unc[]" class="form-control required">
				</div>
			</div>
		</div>

		<div class="row col-8 offset-2" id="calculate-buttons">
			<div class="col-12">
				<div>
					<button type="button" id="calculate" class="btn btn-success"
						data-translate="Calculate">Calculate</button>
				</div>
			</div>
			<div class="col-12 form-group" id="result-tab" style="display:none">
                <br>
				<label for="result" data-translate="Result:">Result:</label>
				<div id="result" class="alert alert-success"></div>
			</div>
		</div>
    </form>

    <div class="row col-12"
        style="position:fixed; bottom:0px; text-align: left; width:100%; background:white; height: 70px">
        <div class="col-10">
            <small class="form-text text-muted"> &copy; 2021. This work is licensed under a <a rel="license"
                    href="https://creativecommons.org/publicdomain/zero/1.0/">CC0 1.0 license</a>. <br><span>Created by
                    G. Skarakis and A. Kanellakopoulos</span>
        </div>
        <div class="col-2">
            <a rel="license" href="https://creativecommons.org/publicdomain/zero/1.0/"><img
                    alt="Creative Commons Public Domain Dedication" style="border-width:0"
                    src="https://licensebuttons.net/l/zero/1.0/88x31.png" /></a>
        </div>
    </div>
    <script>
        $(document).ready(function () {
            var lang = 'eng'; var myChart = null;
			
            function t(value) {
                switch (lang) {
                    case 'fr':
                        if (french[value]) {
                            return french[value];
                        }
                    case 'de':
                        if (german[value]) {
                            return german[value];
                        }
                    default:
                        return value;
                }
            }

            function translate() {
                $('*[data-translate]').each(function () {
                    let translation = t($(this).data('translate'));
                    if ($(this).is("input")) {
                        $(this).val(translation);
                    } else {
                        $(this).html(translation);
                    }
                })
            }

            if (typeof (Storage) !== "undefined") {
                let storedlang = localStorage.getItem("language");
                if (storedlang) {
                    lang = storedlang;
                    translate();
                }
            }

            $('.languages').on('click', function () {
                lang = $(this).data('lang');
                translate();
                if (typeof (Storage) !== "undefined") {
                    localStorage.setItem("language", lang);
                }
            })

            $('#addsample-btn').on('click', function () {
                $("input[name='val[]']").last().after('<input type="number" name="val[]" class="form-control required">');
                $("input[name='unc[]']").last().after('<input type="number" name="unc[]" class="form-control required">');
            })

            $('#removesample-btn').on('click', function () {
                if ($("input[name='val[]']").length == 1) {
                    return false;
                }
                $("input[name='val[]']").last().remove();
                $("input[name='unc[]']").last().remove();
            })

            $('#calculate').on('click', async function (event, arg1) {

                var result = null;

				//Arrays με τις τιμές του κάθε κουτιού
				var valAr = $("input[name='val[]']").map(function () { return parseFloat($(this).val()); }).get();
				var uncAr = $("input[name='unc[]']").map(function () { return parseFloat($(this).val()); }).get();

                var numeratorMean = 0.
                var denominatorMean = 0.
                var numeratorSigmaScat = 0.

				console.log(valAr);
				console.log(uncAr);

                for (var i in valAr) {
                    numeratorMean += valAr[i]/Math.pow(uncAr[i],2)
                    denominatorMean += 1/Math.pow(uncAr[i],2)
                }

                var meanWeight = numeratorMean/denominatorMean;
                var sigmaStatSq = 1/denominatorMean;

                for (var i in valAr) {
                    numeratorSigmaScat += Math.pow((valAr[i]-meanWeight)/uncAr[i],2)
                }

                var sigmaScatSq = numeratorSigmaScat/((valAr.length-1)*denominatorMean);

                if (sigmaStatSq>sigmaScatSq){
                    var meanWeightSigma = Math.pow(sigmaStatSq,0.5)
                } else {
                    var meanWeightSigma = Math.pow(sigmaScatSq,0.5)
                }

				result = meanWeight + ' &pm; ' + meanWeightSigma;

			$('#result').html('&lt;x&gt; = ' + result);
			$('#result-tab').show();

            })
        })
    </script>
</body>

</html>